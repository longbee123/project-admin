<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head">
</head>
<style>
table{width:100%;}
table td, table th { border: 1px solid grey;}
table th { background: #eee;}
.pagination-div{user-select: none;}
.pagination-div span{border-radius:3px;border:1px solid #999;
   padding:5px;margin:10px 0px 0px 10px;display:inline-block}
span.selected{background:#ccf;}
#menu {
    float: left;
    width: 10%;
    height: 570px;
    background: #eee;
    padding: 20px;
}

.modal-dialog{
	max-width:1440px


}
#menu1{
	height: 100px;
	border-style: none;
}
#menu2{
	height: 100px;
	border-style: none;
}
#menu3{
	height: 100px;
	border-style: none;
}


<!--#text1 {-->
<!--    overflow: hidden;-->
<!--   text-overflow: ellipsis;-->
<!--   display: -webkit-box;-->
<!--   line-height: 64px;     /* fallback */-->
<!--   max-height: 64px;      /* fallback */-->
<!--   -webkit-line-clamp: 1; /* number of lines to show */-->
<!--   -webkit-box-orient: vertical;-->
<!--}-->

</style>
<body>
	<nav th:replace="layout :: header"></nav>
	<div th:replace="layout :: menu"></div>

	<div class="container" id="main-content">
<!--		<div class ="myForm  ">-->

			<div class="modal fade " id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog " role="document" >
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">Tạo Sản Phẩm</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form>
								<div class="form-group col-6">
									<label for="name" class="col-form-label">Name:</label>
									<input type="text" class="form-control" id="name" name="name" value="">
								</div>
								<div class="form-group col-12">
									<label for="description" class="col-form-label">Miêu tả:</label>
									<textarea class="form-control" id="description"></textarea>
								</div>

							<div class="form-group col-6">
								<label for="price" class="col-form-label">Giá:</label>
								<input type="number" class="form-control" id="price" name="price" value="">
							</div>
								<div class="form-group col-4">
									<label for="selector1" class=" col-control-label">Hãng Xe:</label>
									<div class="">
										<select name="selector1" class="form-control" id="selector1" >
										<option th:each="brand: ${brand}" th:value="${brand.id}" th:text="${brand.name}"></option>
									   </select>
									</div>
								</div>
								<div class="form-group" >
									<form >
									<label for="exampleInputFile" class="col-sm-2 control-label">Image</label>
									<div class="col-sm-8">
										<input type="file" id="exampleInputFile">
									</div>
									</form>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label"></label>
									<div class="col-sm-2">
										<img id="img123" style="max-width: 200px; height: auto"
											 src="https://www.vietnamprintpack.com/images/default.jpg"
											 class="product-main-image">
									</div>
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="submit" id="btnSave" class="btn btn-primary" >Save</button>
						</div>
					</div>
				</div>

			</div>

			<div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content ">
						<div class="container-fluid ">
						<div class="modal-header ">
							<h5 class="modal-title" id="editModalLabel">Chỉnh Sửa Sản Phẩm</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body" >

								<div class="form-group col-6">
									<label for="name" class="col-form-label">Name:</label>
									<input type="text" class="form-control" id="name1" name="name" value="">
								</div>
								<div class="form-group col-12">
									<label for="description" class="col-form-label">Miêu tả:</label>
									<textarea class="form-control" id="description1"></textarea>
								</div>

								<div class="form-group col-6">
									<label for="price" class="col-form-label">Giá:</label>
									<input type="number"   class="form-control" id="price1"   name="price" value="">
								</div>
<!--								<div class="form-group col-4">-->
<!--									<label for="selector1" class="col-control-label">Hãng Xe:</label>-->
<!--									<div class="">-->
<!--										<select name="selector2" class=" form-control" id="selector2" >-->
<!--											<option  th:each="brand: ${brand}" th:value="${brand.id}" th:text="${brand.name}"></option>-->
<!--										</select>-->
<!--									</div>-->
<!--								</div>-->
								<div class="form-group" >
									<form >
										<label for="exampleInputFile" class=" control-label">Image</label>
										<div class="col-sm-8">
											<input type="file" id="exampleInputFile1">
										</div>
									</form>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label"></label>
									<div class="col-sm-2">
										<img id="img1234" style="max-width: 200px; height: auto"
											 src="https://www.vietnamprintpack.com/images/default.jpg"
											 class="product-main-image">
									</div>
								</div>
								<input type="hidden" class="form-control" id="id"  value="">

						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="submit" id="btnSave1" class="btn btn-primary" >Save</button>
						</div>
						</div>
					</div>
				</div>

			</div>
			<div class="modal fade" id="detail" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="detailModalLabel">Thông Tin Sản Phẩm</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form>

								<div class="form-group col-12">
									<label for="description" class="col-form-label"></label>
									<textarea class="form-control" readonly="readonly" id="description2"></textarea>
								</div>

								<input type="hidden" class="form-control" id="id1"  value="">
							</form>
						</div>
<!--						<div class="modal-footer">-->
<!--							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
<!--							<button type="submit" id="btnSave2" class="btn btn-primary" >Save</button>-->
<!--						</div>-->
					</div>
				</div>

			</div>
<!--		</div>-->
		<div class="row">
			<div class="col-6 no-padding">
				<form class="form-inline" th:action="@{/product}" method="get" >
					<input class="form-control mr-sm-2"   type="search" name="name" th:value="*{name}" placeholder="Tìm kiếm theo tên...."  />
					<button class="btn btn-primary" id="btn-search" type="submit">
						<i class="fa fa-search"></i>
					</button>
				</form>
			</div>

			<div class="col-6 no-padding">
<!--				<a  class="btn btn-success float-right">-->
					<button type="button" class="btn btn-dark float-right" data-toggle="modal" data-target="#exampleModal" data-whatever="@getbootstrap">Tạo sản phẩm</button>
<!--				</a>-->

			</div>
<!--			<form method="post" th:action="@{/uploadFile}" enctype="multipart/form-data" th:object="${myFile}">-->
<!--				File: <input type="file" th:field="*{multipartFile}" /> <br /> <br />-->
<!--				<input type="submit" value="Submit" />-->
<!--			</form>-->

		</div>

		<div class="row mt-4">
			<div th:if="${successMessage}" class="col-12 alert alert-success alert-dismissible fade show" role="alert">
				<span th:text="${successMessage}"></span>
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>


			</th:block>
			<th:block th:if="${#lists.isEmpty(product.content)}">
				<h5>Không Tìm Thấy Sản Phẩm</h5>
			</th:block>

			<th:block th:unless="${#lists.isEmpty(product.content)}">
				<div class="table-responsive">
					<h5>Danh Sách Sản Phẩm</h5>
					<table class="table table-bordered table-hover">
						<thead class="thead-dark">
						<tr>
							<th>Stt</th>
							<th>Tên</th>
							<th>Hãng</th>
							<th>Hình Ảnh</th>
							<th>Thông tin</th>
							<th>Ngày Tạo</th>
							<th>Giá</th>
							<th>Action</th>

						</tr>
						</thead>
						<tbody class="list-user">
						<tr th:each="product,state : ${product.content}" th:data-id="${product.productId}">

							<th scope="row" th:text="${state.count}"></th>
							<td th:text="${product.name}"></td>
							<td th:text="${product.brand.name}"></td>
							<td><img style="max-width: 100px; height: auto" th:src="@{${product.thumbnail}}"></td>
<!--							<td><p th:text="${#strings.abbreviate(product.description,20)} "></p></td>-->
							<td><a>
								<button type="button" class="btn btn-dark" data-toggle="modal" data-target="#detail"
										th:data-description1="${product.description}"
								>Xem</button>
							</a></td>
							<td th:text="${#dates.format(product.createDate, 'dd/MM/yyyy')}"></td>
<!--							<td th:text="${product.brand}"></td>-->
							<td th:text="${#numbers.formatDecimal(product.price, 10, 'COMMA', 0, 'POINT')}"></td>
<!--							<td th:text="${product.stockAmount}"></td>-->
							<td>
								<a  class="mr-sm-1 text-primary" >
									<button type="button" class="btn btn-info" data-toggle="modal" data-target="#edit" th:data-name="${product.name}"
											th:data-description="${product.description}"
											th:data-price="${product.price}"
											th:data-id="${product.productId}"
											th:data-thumbnail="${product.thumbnail}"
											th:data-brandid="${product.brand.id}"
											th:data-brandname="${product.brand.name}"


									>Sửa</button>
								</a>
<!--								<a>-->
<!--									<button type="button" class="btn btn-dark" data-toggle="modal" data-target="#detail"-->
<!--											th:data-description1="${product.description}"-->
<!--									>detail</button>-->
<!--								</a>-->
								<a th:onclick="'deleteUser('+${product.productId}+')'" class="text-danger">
									<i class="fa fa-trash"></i>
								</a>
							</td>

						</tr>
						</tbody>
					</table>
					<hr/>
<!--					<ul class="nav nav-pills">-->
<!--						<li class="nav-item" th:each="i: ${#numbers.sequence(1,listuser.totalPages)}">-->
<!--							<a id="page"  th:href="@{/(page=${i})}" th:text="${i}" class="nav-link"-->
<!--							th:classappend="${currentPage}==${i}?'active':''"></a>-->
<!--						</li>-->
<!--					</ul>-->
					<div class="pagination-div">
    <span th:if="${product.hasPrevious()}">
        <a th:href="@{/product(page=${product.number-1},size=${product.size},name=${name})}">Previous</a>
    </span>
						<th:block th:each="i: ${#numbers.sequence(0, product.totalPages-1 )}">
							<span th:if="${product.number == i}" class="selected">[[${i}+1]]</span>
							<th:block th:unless="${i} < 0">
							<span th:unless="${product.number == i}">
             <a th:href="@{/product(page=${i},size=${product.size},name=${name})}">[[${i}+1]]</a>

        </span>
							</th:block>
						</th:block>
						<span th:if="${product.hasNext()}">
        <a th:href="@{/product(page=${product.number+1},size=${product.size},name=${name})}">Next</a>
    </span>
					</div>


				</div>
			</th:block>
		</div>

	</div><!-- /.container -->

	<footer th:replace="layout :: footer"></footer>
	<script>
	$('#edit').on('show.bs.modal', function (event) {
	var button = $(event.relatedTarget)
	var name = button.data('name')
	var price = button.data('price')
	var description = button.data('description')
	var brand = button.data('brand')
	var id = button.data('id')
	var thumbnail = button.data('thumbnail')


	var modal = $(this)

	modal.find('.modal-body #name1').val(name)
	modal.find('.modal-body #price1').val(price)
	modal.find('.modal-body #description1').val(description)
	modal.find('.modal-body #id').val(id)
	modal.find('.modal-body #img1234').attr('src',thumbnail)



	})
	$('#detail').on('show.bs.modal', function (event) {
	var button = $(event.relatedTarget)
	var description1 = button.data('description1')
	var modal = $(this)
     modal.find('.modal-body #description2').val(description1)


	})
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			hello();
           });
		function hello() {
			console.log("Hello World");
		};
		$('#btnSave').off('click').on('click',function(){
			event.preventDefault()
			name = $('#name').val()

			price = $('#price').val()
			description = $('#description').val()
			thumbnail = $('#img123').attr('src');
			id = $('#selector1').val()

			// TODO: Validate thông tin ở đây
			 if ($.trim(name) == ''){
                  alert('Bạn chưa nhập tên ');
       			}
<!--       		 else if ($.trim(createDate) == ''){-->
<!--                  alert('Bạn chưa nhập ngày');-->
<!--       			}-->
       		 else if ($.trim(price) == ''){
                  alert('Bạn chưa nhập giá');
       			}
<!--       		else if ($.trim(password) == ''){-->
<!--                  alert('Bạn chưa nhập password');-->
<!--       			}-->
<!--       		else if(!check()){-->

<!--       		}-->
			else{
			req = {
				name: name,
				price: price,
				description: description,
				thumbnail : thumbnail
			}
			console.log(req)
			var myJSON = JSON.stringify(req);
			console.log(myJSON)
			$.ajax({
			   	url: 'http://localhost:8080/product/create/'+id,
			   	type: 'POST',
			   	data: myJSON,
			   	dataType: "json",
			   	contentType: "application/json; charset=utf-8",
			   	error: function(data) {
			   		alert(data.responseJSON.message)
			   	},
			   	success: function(data) {
			   		alert("Tạo mới thành công")
					window.location.assign('http://localhost:8080/product');
			   	}
			});
			}

		})
		function deleteUser(id) {
			$.ajax({
				url: 'http://localhost:8080/product/'+id,
				type: "DELETE",
				error: function(data) {
				    console.log(data)
				},
				success: function(data) {
				    alert("Xóa thành công")
				    window.location.assign('http://localhost:8080/product');
				}
			});
			return false;
		};

	$('#btnSave1').off('click').on('click',function(){
			event.preventDefault()
			name = $('#name1').val()
			price = $('#price1').val()
			description = $('#description1').val()
			thumbnail = $('#img1234').attr('src');
<!--			id = $('#selector2').val()-->
			id1 = $('#id').val()

			// TODO: Validate thông tin ở đây
			 if ($.trim(name) == ''){
                  alert('Bạn chưa nhập tên ');
       			}
<!--       		 else if ($.trim(createDate) == ''){-->
<!--                  alert('Bạn chưa nhập ngày');-->
<!--       			}-->
       		 else if ($.trim(price) == ''){
                  alert('Bạn chưa nhập giá');
       			}
<!--       		else if ($.trim(password) == ''){-->
<!--                  alert('Bạn chưa nhập password');-->
<!--       			}-->
<!--       		else if(!check()){-->

<!--       		}-->
			else{
			req = {
				name: name,
				price: price,
				description: description,
				thumbnail: thumbnail
			}
			console.log(req)
			var myJSON = JSON.stringify(req);
			console.log(myJSON)
			$.ajax({
			   	url: 'http://localhost:8080/product/update/'+id1,
			   	type: 'PUT',
			   	data: myJSON,
			   	dataType: "json",
			   	contentType: "application/json; charset=utf-8",
			   	error: function(data) {
			   		alert(data.responseJSON.message)
			   	},
			   	success: function(data) {
			   		alert("Thành công")
					window.location.assign('http://localhost:8080/product');
			   	}
			});
			}
		})
		 $("#exampleInputFile").change(function(){
				 var file_data = $('#exampleInputFile').prop('files')[0];
				var formData = new FormData();
				 formData.append('fileData', file_data);
				 $.ajax({
  					  url: "http://localhost:8080/product/upload",
   					 type: "POST",
   					 data: formData,
   					 processData: false,
    				contentType: false,
    				cache: false,
    				success: function (res) {
							console.log("success")
							console.log(res)
<!--						 var imgfilename = $('#exampleInputFile').val().replace(/C:\\fakepath\\/i, '');-->
						 $('#img123').attr('src',res);

   						 },
   					 error: function () {
							console.log("lỗi");
				 }
  });
});
	 $("#exampleInputFile1").change(function(){
				 var file_data = $('#exampleInputFile1').prop('files')[0];
				var formData = new FormData();
				 formData.append('fileData', file_data);
				 $.ajax({
  					  url: "http://localhost:8080/product/upload",
   					 type: "POST",
   					 data: formData,
   					 processData: false,
    				contentType: false,
    				cache: false,
    				success: function (res) {
							console.log("success")
<!--						 var imgfilename = $('#exampleInputFile1').val().replace(/C:\\fakepath\\/i, '');-->
						 $('#img1234').attr('src', res);

   						 },
   					 error: function () {
							console.log("lỗi");
				 }
  });
});
	</script>

</body>
</html>